<script>
    let account;

    const connectMetamask = async () => {
        if (window.ethereum !== "undefined") {
            const accounts = await ethereum.request({ method: "eth_requestAccounts" });
            account = accounts[0];
            document.getElementById("accountArea").innerHTML = `Compte: ${account}`;
        }
    }

    const connectContract = async () => {
        const ABI = [
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_word",
				"type": "string"
			}
		],
		"name": "changeFlower",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "deposit",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_amont",
				"type": "uint256"
			}
		],
		"name": "withdraw",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getAddress",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getBalance",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getFlower",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];
        const Address = "0xd9145CCE52D386f254917e481eB44e9943F39138";
        window.web3 = new Web3(window.ethereum);
        window.contract = new window.web3.eth.Contract(ABI, Address);

        const data = await window.contract.methods.getAddress().call();
        document.getElementById("contractArea").innerHTML = `Contrat connecté: ${data}`;
    }

    // Fonction déclenchée automatiquement lors du chargement de la page
    window.onload = async () => {
        try {
            await connectMetamask();
            await connectContract();
        } catch (error) {
            console.error("Erreur lors de la connexion automatique :", error);
        }
    }

    const getBalanceApple = async () => {
        const data = await window.contract.methods.getBalance().call();
        document.getElementById("balanceArea").innerHTML = `Contract Balance: ${data}`;
    }

    const depositContract = async () => {
        const amount = document.getElementById("depositInput").value;
        await window.contract.methods.deposit().send({ from: account, value: amount });
    }

    const withdraw = async () => {
        const amount = document.getElementById("depositInput").value;
        await window.contract.methods.withdraw(amount).send({ from: account });
    }

    const readWord = async () => {
        const data = await window.contract.methods.getFlower().call();
        document.getElementById("dataArea").innerHTML = `Votre message: ${data}`;
    }

    const changeWord = async () => {
        const myEntry = document.getElementById("inputArea").value;
        await window.contract.methods.changeFlower(myEntry).send({ from: account });
    }

    readWord();
</script>
